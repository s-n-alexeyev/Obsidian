Настройка VPN с использованием протокола WireGuard на Raspberry Pi для создания прокси-сервера может быть выполнена в несколько шагов. Приведенные ниже инструкции предполагают, что у вас уже установлена Raspberry Pi с Raspbian или другой поддерживаемой операционной системой.

>**Установка WireGuard:** Убедитесь, что ваша операционная система и ядро являются достаточно новыми, чтобы поддерживать WireGuard. В большинстве случаев WireGuard уже включен в последние версии Raspbian.
```shell
sudo apt update sudo apt install wireguard
```

>**Создание ключей:** Генерация ключей для сервера и клиента.
```shell
umask 077 wg genkey | tee privatekey | wg pubkey > publickey
```
  
Повторите этот шаг на Raspberry Pi для создания ключей как для сервера, так и для клиента.
   
>**Настройка сервера:** Создайте конфигурационный файл для сервера, например, `wg0.conf`.
```q
[Interface]
PrivateKey = <приватный ключ сервера>
Address = 10.0.0.1/24
ListenPort = 51820

[Peer]
PublicKey = <публичный ключ клиента>
AllowedIPs = 10.0.0.2/32
```

>Запустите WireGuard с созданным конфигурационным файлом:
```shell
sudo wg-quick up wg0
```

>Убедитесь, что WireGuard запускается при каждом запуске системы:
```shell
sudo systemctl enable wg-quick@wg0
```

>**Настройка клиента:** Создайте конфигурационный файл для клиента, например, `wg-client.conf`.  
```q
[Interface]
PrivateKey = <приватный ключ клиента>
Address = 10.0.0.2/24

[Peer]
PublicKey = <публичный ключ сервера>
Endpoint = <IP-адрес сервера>:51820
AllowedIPs = 0.0.0.0/0
```

>Запустите WireGuard на клиенте с созданным конфигурационным файлом.
```shell
sudo wg-quick up wg-client
```

>**Настройка прокси-сервера:** Установите и настройте прокси-сервер, например, Squid.
```shell
sudo apt install squid
```

>Отредактируйте конфигурационный файл Squid (обычно `/etc/squid/squid.conf`) с учетом ваших потребностей.
```shell
sudo nano /etc/squid/squid.conf
```

>Например, добавьте следующую строку, чтобы разрешить все запросы:
```ini
http_access allow all
```

>Перезапустите Squid:
```shell
sudo service squid restart
````

Теперь ваш Raspberry Pi должен быть настроен как сервер WireGuard с прокси-сервером, и вы можете подключаться к нему удаленно через VPN. Убедитесь, что правила маршрутизации на сервере и клиенте соответствуют вашим потребностям, и обеспечьте безопасность, используя, например, файрволы и шифрование.